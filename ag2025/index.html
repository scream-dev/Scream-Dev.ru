<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Discord Analytics</title>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Recharts -->
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
</head>

<body style="margin:0">
  <div id="root"></div>

  <script type="text/babel">
    const {
      PieChart, Pie, Cell,
      ResponsiveContainer,
      Legend, Tooltip
    } = Recharts;

    const DiscordStats = () => {
      const data = [
        { name: '–¢–∏–º—É—Ä', messages2025: 4224, messagesTotal: 14097 },
        { name: '–ú–∞–∫–∞—Ä', messages2025: 4581, messagesTotal: 17170 },
        { name: '–ú–∞—Ç–≤–µ–π', messages2025: 1995, messagesTotal: 5344 },
        { name: '–î–µ–Ω–∏—Å', messages2025: 3166, messagesTotal: 11591 },
        { name: '–ö–æ–ª—è', messages2025: 198, messagesTotal: 688 },
        { name: '–®–∞–º–∏–ª—å', messages2025: 1211, messagesTotal: 1351 },
        { name: '–î–∞–Ω–∏–∏–ª', messages2025: 6, messagesTotal: 54 },
        { name: '–ò–ª—å—Å–∞—Ñ', messages2025: 465, messagesTotal: 1110 }
      ];

      const data2025 = data.map(i => ({ name: i.name, value: i.messages2025 }));
      const dataTotal = data.map(i => ({ name: i.name, value: i.messagesTotal }));

      const COLORS = ['#EF4444','#3B82F6','#EC4899','#8B5CF6','#F97316','#06B6D4','#F59E0B','#10B981'];

      const total2025 = data.reduce((s, i) => s + i.messages2025, 0);
      const totalAll = data.reduce((s, i) => s + i.messagesTotal, 0);
      const avg2025 = Math.round(total2025 / data.length);
      const avgAll = Math.round(totalAll / data.length);

      const mostActive = [...data].sort((a,b)=>b.messages2025-a.messages2025)[0];
      const mostActiveAll = [...data].sort((a,b)=>b.messagesTotal-a.messagesTotal)[0];

      const median2025 =
        [...data].sort((a,b)=>a.messages2025-b.messages2025)[Math.floor(data.length/2)].messages2025;

      const topList = [...data]
        .sort((a,b)=>b.messages2025-a.messages2025)
        .map(i => ({ ...i, percentage: ((i.messages2025 / i.messagesTotal) * 100).toFixed(1) }));

      const CustomTooltip = ({ active, payload }) => {
        if (active && payload && payload.length) {
          const total = payload[0].payload.total;
          const percent = ((payload[0].value / total) * 100).toFixed(1);
          return (
            <div style={{
              background:'#1F2937',padding:'12px',
              border:'2px solid #374151',borderRadius:'8px'
            }}>
              <p style={{margin:0,fontWeight:'bold',color:'#F3F4F6'}}>
                {payload[0].name}
              </p>
              <p style={{margin:'5px 0 0',color:'#9CA3AF'}}>
                {payload[0].value.toLocaleString()} —Å–æ–æ–±—â–µ–Ω–∏–π ({percent}%)
              </p>
            </div>
          );
        }
        return null;
      };

      const renderLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent }) => {
        if (percent < 0.03) return null;
        const r = innerRadius + (outerRadius-innerRadius)*0.5;
        const x = cx + r * Math.cos(-midAngle * Math.PI / 180);
        const y = cy + r * Math.sin(-midAngle * Math.PI / 180);
        return (
          <text x={x} y={y} fill="white"
            textAnchor={x > cx ? 'start' : 'end'}
            dominantBaseline="central"
            style={{fontSize:'14px',fontWeight:'bold'}}>
            {(percent*100).toFixed(0)}%
          </text>
        );
      };

      return (
        <div style={{
          minHeight:'100vh',
          background:'linear-gradient(135deg,#1a1a2e,#0f0f1e)',
          padding:'40px 20px',
          fontFamily:'Segoe UI, sans-serif'
        }}>
          <h1 style={{
            textAlign:'center',
            fontSize:'48px',
            fontWeight:900,
            color:'#EF4444'
          }}>
            üìä Discord Analytics
          </h1>

          <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'30px'}}>
            {[{title:'üî• 2025 –≥–æ–¥',data:data2025,total:total2025,color:'#EF4444'},
              {title:'‚è≥ –í—Å—ë –≤—Ä–µ–º—è',data:dataTotal,total:totalAll,color:'#3B82F6'}]
              .map((cfg,idx)=>(
              <div key={idx} style={{background:'#1F2937',padding:'30px',borderRadius:'16px'}}>
                <h2 style={{textAlign:'center',color:cfg.color}}>{cfg.title}</h2>
                <ResponsiveContainer width="100%" height={350}>
                  <PieChart>
                    <Pie
                      data={cfg.data.map(d=>({...d,total:cfg.total}))}
                      cx="50%" cy="50%"
                      outerRadius={130}
                      label={renderLabel}
                      labelLine={false}
                      dataKey="value"
                    >
                      {cfg.data.map((_,i)=>(
                        <Cell key={i} fill={COLORS[i%COLORS.length]} />
                      ))}
                    </Pie>
                    <Tooltip content={<CustomTooltip />} />
                    <Legend />
                  </PieChart>
                </ResponsiveContainer>
              </div>
            ))}
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<DiscordStats />);
  </script>
</body>
</html>
