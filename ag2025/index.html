import React from 'react';
import { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from 'recharts';

const DiscordStats = () => {
  const data = [
    { name: '–¢–∏–º—É—Ä', messages2025: 4224, messagesTotal: 14097 },
    { name: '–ú–∞–∫–∞—Ä', messages2025: 4581, messagesTotal: 17170 },
    { name: '–ú–∞—Ç–≤–µ–π', messages2025: 1995, messagesTotal: 5344 },
    { name: '–î–µ–Ω–∏—Å', messages2025: 3166, messagesTotal: 11591 },
    { name: '–ö–æ–ª—è', messages2025: 198, messagesTotal: 688 },
    { name: '–®–∞–º–∏–ª—å', messages2025: 1211, messagesTotal: 1351 },
    { name: '–î–∞–Ω–∏–∏–ª', messages2025: 6, messagesTotal: 54 },
    { name: '–ò–ª—å—Å–∞—Ñ', messages2025: 465, messagesTotal: 1110 }
  ];

  const data2025 = data.map(item => ({
    name: item.name,
    value: item.messages2025
  }));

  const dataTotal = data.map(item => ({
    name: item.name,
    value: item.messagesTotal
  }));

  const COLORS = ['#EF4444', '#3B82F6', '#EC4899', '#8B5CF6', '#F97316', '#06B6D4', '#F59E0B', '#10B981'];

  const total2025 = data.reduce((sum, item) => sum + item.messages2025, 0);
  const totalAll = data.reduce((sum, item) => sum + item.messagesTotal, 0);
  const avg2025 = Math.round(total2025 / data.length);
  const avgAll = Math.round(totalAll / data.length);
  const mostActive = [...data].sort((a, b) => b.messages2025 - a.messages2025)[0];
  const mostActiveAll = [...data].sort((a, b) => b.messagesTotal - a.messagesTotal)[0];
  const median2025 = [...data].sort((a, b) => a.messages2025 - b.messages2025)[Math.floor(data.length / 2)].messages2025;
  
  const topList = [...data]
    .sort((a, b) => b.messages2025 - a.messages2025)
    .map(item => ({
      ...item,
      percentage: ((item.messages2025 / item.messagesTotal) * 100).toFixed(1)
    }));

  const CustomTooltip = ({ active, payload }) => {
    if (active && payload && payload.length) {
      const total = payload[0].payload.total;
      const percent = ((payload[0].value / total) * 100).toFixed(1);
      return (
        <div style={{
          backgroundColor: '#1F2937',
          padding: '12px',
          border: '2px solid #374151',
          borderRadius: '8px',
          boxShadow: '0 4px 6px rgba(0, 0, 0, 0.3)'
        }}>
          <p style={{ margin: 0, fontWeight: 'bold', color: '#F3F4F6' }}>{payload[0].name}</p>
          <p style={{ margin: '5px 0 0 0', color: '#9CA3AF' }}>
            {payload[0].value.toLocaleString()} —Å–æ–æ–±—â–µ–Ω–∏–π ({percent}%)
          </p>
        </div>
      );
    }
    return null;
  };

  const renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent }) => {
    if (percent < 0.03) return null;
    const radius = innerRadius + (outerRadius - innerRadius) * 0.5;
    const x = cx + radius * Math.cos(-midAngle * Math.PI / 180);
    const y = cy + radius * Math.sin(-midAngle * Math.PI / 180);

    return (
      <text 
        x={x} 
        y={y} 
        fill="white" 
        textAnchor={x > cx ? 'start' : 'end'} 
        dominantBaseline="central"
        style={{ fontSize: '14px', fontWeight: 'bold', textShadow: '0 0 3px rgba(0,0,0,0.5)' }}
      >
        {`${(percent * 100).toFixed(0)}%`}
      </text>
    );
  };

  return (
    <div style={{ 
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%)',
      padding: '40px 20px',
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
    }}>
      <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
        <div style={{ 
          textAlign: 'center', 
          marginBottom: '50px',
          padding: '30px',
          background: 'rgba(239, 68, 68, 0.1)',
          borderRadius: '16px',
          border: '2px solid rgba(239, 68, 68, 0.3)'
        }}>
          <h1 style={{ 
            fontSize: '48px',
            fontWeight: '900',
            background: 'linear-gradient(135deg, #EF4444 0%, #3B82F6 100%)',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent',
            marginBottom: '10px'
          }}>
            üìä Discord Analytics
          </h1>
          <p style={{ color: '#9CA3AF', fontSize: '18px', margin: 0 }}>
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥—Ä—É–∑–µ–π –∑–∞ 2025
          </p>
        </div>

        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(500px, 1fr))',
          gap: '30px',
          marginBottom: '50px'
        }}>
          <div style={{
            background: 'rgba(31, 41, 55, 0.6)',
            backdropFilter: 'blur(10px)',
            borderRadius: '16px',
            padding: '30px',
            border: '2px solid rgba(239, 68, 68, 0.3)',
            boxShadow: '0 8px 32px rgba(239, 68, 68, 0.15)'
          }}>
            <h2 style={{ 
              textAlign: 'center', 
              color: '#EF4444', 
              marginBottom: '20px',
              fontSize: '28px',
              fontWeight: '700'
            }}>
              üî• 2025 –≥–æ–¥
            </h2>
            <ResponsiveContainer width="100%" height={350}>
              <PieChart>
                <Pie
                  data={data2025.map(d => ({ ...d, total: total2025 }))}
                  cx="50%"
                  cy="50%"
                  labelLine={false}
                  label={renderCustomizedLabel}
                  outerRadius={130}
                  fill="#8884d8"
                  dataKey="value"
                  strokeWidth={2}
                  stroke="#1F2937"
                >
                  {data2025.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                  ))}
                </Pie>
                <Tooltip content={<CustomTooltip />} />
                <Legend 
                  wrapperStyle={{ color: '#F3F4F6' }}
                  iconType="circle"
                />
              </PieChart>
            </ResponsiveContainer>
          </div>

          <div style={{
            background: 'rgba(31, 41, 55, 0.6)',
            backdropFilter: 'blur(10px)',
            borderRadius: '16px',
            padding: '30px',
            border: '2px solid rgba(59, 130, 246, 0.3)',
            boxShadow: '0 8px 32px rgba(59, 130, 246, 0.15)'
          }}>
            <h2 style={{ 
              textAlign: 'center', 
              color: '#3B82F6', 
              marginBottom: '20px',
              fontSize: '28px',
              fontWeight: '700'
            }}>
              ‚è≥ –í—Å—ë –≤—Ä–µ–º—è
            </h2>
            <ResponsiveContainer width="100%" height={350}>
              <PieChart>
                <Pie
                  data={dataTotal.map(d => ({ ...d, total: totalAll }))}
                  cx="50%"
                  cy="50%"
                  labelLine={false}
                  label={renderCustomizedLabel}
                  outerRadius={130}
                  fill="#8884d8"
                  dataKey="value"
                  strokeWidth={2}
                  stroke="#1F2937"
                >
                  {dataTotal.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                  ))}
                </Pie>
                <Tooltip content={<CustomTooltip />} />
                <Legend 
                  wrapperStyle={{ color: '#F3F4F6' }}
                  iconType="circle"
                />
              </PieChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div style={{
          background: 'rgba(31, 41, 55, 0.6)',
          backdropFilter: 'blur(10px)',
          borderRadius: '16px',
          padding: '40px',
          marginBottom: '50px',
          border: '2px solid rgba(139, 92, 246, 0.3)',
          boxShadow: '0 8px 32px rgba(139, 92, 246, 0.15)'
        }}>
          <h2 style={{ 
            textAlign: 'center', 
            color: '#8B5CF6', 
            marginBottom: '30px',
            fontSize: '32px',
            fontWeight: '700'
          }}>
            üìà –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
          </h2>
          
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
            gap: '20px',
            marginBottom: '30px'
          }}>
            <div style={{
              background: 'rgba(239, 68, 68, 0.15)',
              padding: '20px',
              borderRadius: '12px',
              border: '2px solid rgba(239, 68, 68, 0.3)'
            }}>
              <div style={{ fontSize: '14px', color: '#9CA3AF', marginBottom: '5px' }}>
                –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π 2025
              </div>
              <div style={{ fontSize: '32px', fontWeight: '900', color: '#EF4444' }}>
                {total2025.toLocaleString()}
              </div>
            </div>

            <div style={{
              background: 'rgba(59, 130, 246, 0.15)',
              padding: '20px',
              borderRadius: '12px',
              border: '2px solid rgba(59, 130, 246, 0.3)'
            }}>
              <div style={{ fontSize: '14px', color: '#9CA3AF', marginBottom: '5px' }}>
                –í—Å–µ–≥–æ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
              </div>
              <div style={{ fontSize: '32px', fontWeight: '900', color: '#3B82F6' }}>
                {totalAll.toLocaleString()}
              </div>
            </div>

            <div style={{
              background: 'rgba(236, 72, 153, 0.15)',
              padding: '20px',
              borderRadius: '12px',
              border: '2px solid rgba(236, 72, 153, 0.3)'
            }}>
              <div style={{ fontSize: '14px', color: '#9CA3AF', marginBottom: '5px' }}>
                –°—Ä–µ–¥–Ω–µ–µ –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞ (2025)
              </div>
              <div style={{ fontSize: '32px', fontWeight: '900', color: '#EC4899' }}>
                {avg2025.toLocaleString()}
              </div>
            </div>

            <div style={{
              background: 'rgba(139, 92, 246, 0.15)',
              padding: '20px',
              borderRadius: '12px',
              border: '2px solid rgba(139, 92, 246, 0.3)'
            }}>
              <div style={{ fontSize: '14px', color: '#9CA3AF', marginBottom: '5px' }}>
                –°—Ä–µ–¥–Ω–µ–µ –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞ (–≤—Å–µ–≥–æ)
              </div>
              <div style={{ fontSize: '32px', fontWeight: '900', color: '#8B5CF6' }}>
                {avgAll.toLocaleString()}
              </div>
            </div>

            <div style={{
              background: 'rgba(249, 115, 22, 0.15)',
              padding: '20px',
              borderRadius: '12px',
              border: '2px solid rgba(249, 115, 22, 0.3)'
            }}>
              <div style={{ fontSize: '14px', color: '#9CA3AF', marginBottom: '5px' }}>
                –ú–µ–¥–∏–∞–Ω–∞ (2025)
              </div>
              <div style={{ fontSize: '32px', fontWeight: '900', color: '#F97316' }}>
                {median2025.toLocaleString()}
              </div>
            </div>

            <div style={{
              background: 'rgba(6, 182, 212, 0.15)',
              padding: '20px',
              borderRadius: '12px',
              border: '2px solid rgba(6, 182, 212, 0.3)'
            }}>
              <div style={{ fontSize: '14px', color: '#9CA3AF', marginBottom: '5px' }}>
                –°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π (2025)
              </div>
              <div style={{ fontSize: '24px', fontWeight: '900', color: '#06B6D4' }}>
                {mostActive.name}
              </div>
              <div style={{ fontSize: '14px', color: '#9CA3AF' }}>
                {mostActive.messages2025.toLocaleString()} —Å–æ–æ–±—â–µ–Ω–∏–π
              </div>
            </div>

            <div style={{
              background: 'rgba(245, 158, 11, 0.15)',
              padding: '20px',
              borderRadius: '12px',
              border: '2px solid rgba(245, 158, 11, 0.3)'
            }}>
              <div style={{ fontSize: '14px', color: '#9CA3AF', marginBottom: '5px' }}>
                –°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π (–≤—Å–µ–≥–æ)
              </div>
              <div style={{ fontSize: '24px', fontWeight: '900', color: '#F59E0B' }}>
                {mostActiveAll.name}
              </div>
              <div style={{ fontSize: '14px', color: '#9CA3AF' }}>
                {mostActiveAll.messagesTotal.toLocaleString()} —Å–æ–æ–±—â–µ–Ω–∏–π
              </div>
            </div>

            <div style={{
              background: 'rgba(16, 185, 129, 0.15)',
              padding: '20px',
              borderRadius: '12px',
              border: '2px solid rgba(16, 185, 129, 0.3)'
            }}>
              <div style={{ fontSize: '14px', color: '#9CA3AF', marginBottom: '5px' }}>
                –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ 2025
              </div>
              <div style={{ fontSize: '32px', fontWeight: '900', color: '#10B981' }}>
                {((total2025 / totalAll) * 100).toFixed(1)}%
              </div>
              <div style={{ fontSize: '14px', color: '#9CA3AF' }}>
                –æ—Ç –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
              </div>
            </div>
          </div>
        </div>

        <div style={{
          background: 'rgba(31, 41, 55, 0.6)',
          backdropFilter: 'blur(10px)',
          borderRadius: '16px',
          padding: '40px',
          border: '2px solid rgba(239, 68, 68, 0.3)',
          boxShadow: '0 8px 32px rgba(239, 68, 68, 0.15)'
        }}>
          <h2 style={{ 
            textAlign: 'center', 
            color: '#EF4444', 
            marginBottom: '30px',
            fontSize: '32px',
            fontWeight: '700'
          }}>
            üèÜ –¢–æ–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ 2025
          </h2>
          <div style={{ maxWidth: '800px', margin: '0 auto' }}>
            {topList.map((item, index) => (
              <div
                key={item.name}
                style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  padding: '20px 25px',
                  marginBottom: '15px',
                  background: index === 0 
                    ? 'linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(239, 68, 68, 0.1))' 
                    : index === 1 
                    ? 'linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(59, 130, 246, 0.1))' 
                    : index === 2 
                    ? 'linear-gradient(135deg, rgba(236, 72, 153, 0.3), rgba(236, 72, 153, 0.1))' 
                    : 'rgba(31, 41, 55, 0.5)',
                  borderRadius: '12px',
                  border: `2px solid ${index === 0 ? 'rgba(239, 68, 68, 0.5)' : index === 1 ? 'rgba(59, 130, 246, 0.5)' : index === 2 ? 'rgba(236, 72, 153, 0.5)' : 'rgba(75, 85, 99, 0.3)'}`,
                  boxShadow: index < 3 ? '0 4px 20px rgba(0, 0, 0, 0.3)' : '0 2px 10px rgba(0, 0, 0, 0.2)',
                  transform: index === 0 ? 'scale(1.02)' : 'scale(1)',
                  transition: 'transform 0.2s'
                }}
              >
                <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                  <span style={{ 
                    fontSize: '28px', 
                    fontWeight: '900', 
                    minWidth: '40px',
                    color: index === 0 ? '#EF4444' : index === 1 ? '#3B82F6' : index === 2 ? '#EC4899' : '#9CA3AF'
                  }}>
                    {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`}
                  </span>
                  <span style={{ 
                    fontSize: '22px', 
                    fontWeight: '700', 
                    color: '#F3F4F6' 
                  }}>
                    {item.name}
                  </span>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <div style={{ 
                    fontSize: '20px', 
                    fontWeight: '700', 
                    color: '#F3F4F6',
                    marginBottom: '5px'
                  }}>
                    {item.messages2025.toLocaleString()}
                  </div>
                  <div style={{ 
                    fontSize: '14px', 
                    color: '#9CA3AF',
                    fontWeight: '600'
                  }}>
                    {item.percentage}% –æ—Ç –≤—Å–µ—Ö —Å–≤–æ–∏—Ö
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

export default DiscordStats;
